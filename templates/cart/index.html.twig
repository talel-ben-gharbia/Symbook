{% extends 'layout.html.twig' %}

{% block title %}Your Shopping Cart
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<style>
		.cart-image {
			width: 80px;
			height: 100px;
			object-fit: cover;
		}

		.cart-table th,
		.cart-table td {
			vertical-align: middle;
		}

		.quantity-badge {
			min-width: 30px;
			height: 30px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.cart-summary {
			background-color: #f8f9fa;
			border-radius: 0.5rem;
			box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
			transition: all 0.3s ease;
		}

		.cart-summary:hover {
			box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
		}

		.empty-cart-container {
			min-height: 400px;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
		}

		.action-btn {
			transition: all 0.2s;
		}

		.action-btn:hover {
			transform: translateY(-2px);
		}

		@media(max-width: 767.98px) {
			.cart-table {
				min-width: 650px;
			}

			.cart-actions {
				flex-direction: column;
			}

			.cart-actions .btn {
				width: 100%;
				margin-bottom: 0.5rem;
			}
		}
	</style>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
		function handlePayment(method) {
if (method === 'cash') { // Show the modal for cash payment
const cashModal = new bootstrap.Modal(document.getElementById('cashPaymentModal'));
cashModal.show();
return;
}

// For online payment, use the existing SweetAlert flow
const options = {
online: {
title: 'Secure Online Payment',
text: 'You will be redirected to our secure payment gateway',
icon: 'info',
route: '{{ path('add_order_online') }}'
}
};

Swal.fire({
title: options[method].title,
text: options[method].text,
icon: 'info',
showCancelButton: true,
confirmButtonText: 'Confirm',
cancelButtonText: 'Cancel',
customClass: {
confirmButton: 'btn btn-primary me-2',
cancelButton: 'btn btn-outline-secondary'
},
buttonsStyling: false
}).then((result) => {
if (result.isConfirmed) {
window.location.href = options[method].route;
}
});
}
	</script>
{% endblock %}

{% block body %}
	<div class="container py-5">
		<div class="row justify-content-center">
			<div class="col-lg-10">
				{% if items is empty %}
					<div class="card border-0 shadow-sm rounded-3 overflow-hidden">
						<div class="card-body p-0">
							<div class="empty-cart-container p-5 text-center">
								<div class="mb-4">
									<i class="bi bi-cart-x display-1 text-secondary opacity-50"></i>
								</div>
								<h2 class="h3 mb-3 text-secondary">Your cart is empty</h2>
								<p class="text-muted mb-4">Discover our collection and find something special for your reading pleasure.</p>
								<a href="{{ path('app_book_public_index') }}" class="btn btn-primary btn-lg px-4 py-2 rounded-pill">
									<i class="bi bi-arrow-left me-2"></i>
									Continue Shopping
								</a>
							</div>
						</div>
					</div>
				{% else %}
					<div class="d-flex align-items-center justify-content-between mb-4">
						<h1 class="h3 mb-0">Your Shopping Cart</h1>
						<span class="badge bg-primary rounded-pill fs-6">{{ items|length }}
							item(s)</span>
					</div>

					<div class="row g-4">
						<div class="col-lg-8">
							<div class="card border-0 shadow-sm rounded-3 overflow-hidden mb-4">
								<div class="table-responsive">
									<table class="table cart-table mb-0">
										<thead class="table-light">
											<tr>
												<th scope="col" class="ps-4">Product</th>
												<th scope="col">Details</th>
												<th scope="col" class="text-center">Quantity</th>
												<th scope="col" class="text-end">Price</th>
												<th scope="col" class="text-end pe-4">Actions</th>
											</tr>
										</thead>
										<tbody>
											{% for item in items %}
												<tr>
													<td class="ps-4">
														<img src="{{ item.book.imageUrl }}" class="cart-image rounded shadow-sm border" alt="{{ item.book.title }}" onerror="this.src='https://via.placeholder.com/80x100?text=No+Image'">
													</td>
													<td>
														<h5 class="mb-1">{{ item.book.title }}</h5>
														<p class="text-muted mb-0">by
															{{ item.book.author }}</p>
														<span class="badge bg-light text-dark mt-2">{{ item.book.price|number_format(2) }}
															TND</span>
													</td>
													<td class="text-center">
														<div class="d-flex justify-content-center align-items-center">
															<a href="{{ path('cart_decrement', {id: item.book.id}) }}" class="btn btn-sm btn-outline-secondary rounded-circle me-2 action-btn">
																<i class="bi bi-dash"></i>
															</a>
															<span class="quantity-badge bg-light fw-bold">{{ item.quantity }}</span>
															<a href="{{ path('cart_add', {id: item.book.id}) }}" class="btn btn-sm btn-outline-primary rounded-circle ms-2 action-btn">
																<i class="bi bi-plus"></i>
															</a>
														</div>
													</td>
													<td class="text-end fw-bold">
														{{ (item.book.price * item.quantity)|number_format(2) }}
														TND
													</td>
													<td class="text-end pe-4">
														<a href="{{ path('cart_remove', {id: item.book.id}) }}" class="btn btn-sm btn-outline-danger rounded-pill action-btn">
															<i class="bi bi-trash me-1"></i>
															Remove
														</a>
													</td>
												</tr>
											{% endfor %}
										</tbody>
									</table>
								</div>
							</div>

							<div class="d-flex cart-actions gap-2 mb-4">
								<a href="{{ path('app_book_public_index') }}" class="btn btn-outline-primary rounded-pill">
									<i class="bi bi-arrow-left me-2"></i>
									Continue Shopping
								</a>
								<a href="{{ path('cart_clear') }}" class="btn btn-outline-danger rounded-pill">
									<i class="bi bi-trash me-2"></i>
									Clear Cart
								</a>
							</div>
						</div>

						<div class="col-lg-4">
							<div class="card border-0 shadow-sm rounded-3 overflow-hidden ">
								<div class="card-header bg-primary text-white py-3">
									<h5 class="mb-0">Order Summary</h5>
								</div>
								<div class="card-body">
									<div class="d-flex justify-content-between mb-3">
										<span class="text-muted">Subtotal:</span>
										<span class="fw-bold">{{ total|number_format(2) }}
											TND</span>
									</div>
									<div class="d-flex justify-content-between mb-3">
										<span class="text-muted">Shipping:</span>
										<span class="fw-bold">7.000 TND</span>
									</div>
									<hr>
									<div class="d-flex justify-content-between mb-4">
										<span class="fw-bold fs-5">Total:</span>
										<span class="fw-bold fs-5 text-primary">{{ (total + 7)|number_format(3) }}
											TND</span>
									</div>

									<div class="d-grid gap-2">
										<button onclick="handlePayment('online')" class="btn btn-success btn-lg rounded-pill">
											<i class="bi bi-credit-card me-2"></i>
											Pay Online
										</button>
										<button onclick="handlePayment('cash')" class="btn btn-outline-primary btn-lg rounded-pill">
											<i class="bi bi-cash-coin me-2"></i>
											Pay with Cash
										</button>
									</div>

									<div class="mt-4 text-center">
										<div class="d-flex justify-content-center gap-2 mb-2">
											<i class="bi bi-shield-check text-success fs-5"></i>
											<span class="text-muted small">Secure Payment</span>
										</div>
										<div class="d-flex justify-content-center gap-2">
											<i class="bi bi-truck text-primary fs-5"></i>
											<span class="text-muted small">Fast Delivery</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				{% endif %}
			</div>
		</div>
	</div>

	<div class="modal fade" id="cashPaymentModal" tabindex="-1" aria-labelledby="cashPaymentModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form action="{{ path('add_order_cash') }}" method="post">
					<div class="modal-header">
						<h5 class="modal-title" id="cashPaymentModalLabel">Cash on Delivery - Delivery Details</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div class="mb-3">
							<label for="address" class="form-label">Delivery Address</label>
							<textarea class="form-control" id="address" name="address" rows="3" required></textarea>
							<div class="form-text">Please provide your complete delivery address including city and postal code.</div>
						</div>
						<div class="mb-3">
							<label for="phone" class="form-label">Phone Number</label>
							<input type="tel" class="form-control" id="phone" name="phone" required>
							<div class="form-text">Our delivery team will contact you on this number.</div>
						</div>
						<div class="alert alert-info d-flex align-items-center">
							<i class="bi bi-info-circle-fill me-2"></i>
							<div>
								<small>You will pay
									<strong>{{ (total + 7)|number_format(3) }}
										TND</strong>
									when your order is delivered.</small>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Confirm Order</button>
					</div>
				</form>
			</div>
		</div>
	</div>
{% endblock %}
