{% extends 'layout.html.twig' %}

{% block title %}My Orders
{% endblock %}

{% block stylesheets %}
	<style>
		.order-details-container {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 20px;
			margin-bottom: 30px;
		}
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
		.order-card {
			background-color: var(--light-bg);
			border-radius: 8px;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
			padding: 20px;
		}

		.order-card-title {
			font-size: 1.1rem;
			font-weight: 600;
			margin-top: 0;
			margin-bottom: 15px;
			padding-bottom: 10px;
			border-bottom: 1px solid #e5e7eb;
		}

		.order-info-grid {
			display: grid;
			grid-template-columns: 120px 1fr;
			gap: 10px;
		}

		.order-info-label {
			font-weight: 500;
			color: #6b7280;
		}

		.order-info-value {
			font-weight: 500;
		}

		.status-badge {
			display: inline-block;
			padding: 4px 8px;
			border-radius: 4px;
			font-size: 0.875rem;
			font-weight: 500;
		}

		.status-processing {
			background-color: var(--processing);
			color: var(--processing-text);
		}

		.status-completed {
			background-color: var(--completed);
			color: var(--completed-text);
		}

		.status-pending {
			background-color: var(--pending);
			color: var(--pending-text);
		}

		.status-cancelled {
			background-color: var(--cancelled);
			color: var(--cancelled-text);
		}

		.order-items-section {
			background-color: var(--light-bg);
			border-radius: 8px;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
			overflow: hidden;
			margin-bottom: 30px;
		}

		.order-items-title {
			font-size: 1.1rem;
			font-weight: 600;
			padding: 20px;
			background-color: #f9fafb;
			border-bottom: 1px solid #e5e7eb;
			margin: 0;
		}

		.order-items-table {
			width: 100%;
			border-collapse: collapse;
		}

		.order-items-table th {
			text-align: left;
			padding: 12px 16px;
			font-weight: 600;
			color: #4b5563;
			background-color: #f9fafb;
			border-bottom: 2px solid #e5e7eb;
		}

		.order-items-table td {
			padding: 12px 16px;
			border-bottom: 1px solid #e5e7eb;
			vertical-align: middle;
		}

		.order-items-table tr:hover {
			background-color: #f9fafb;
		}

		.order-items-table tr:last-child td {
			border-bottom: none;
		}

		.product-info {
			display: flex;
			align-items: center;
			gap: 12px;
		}

		.product-image {
			width: 60px;
			height: 80px;
			object-fit: cover;
			border-radius: 4px;
		}

		.product-details {
			display: flex;
			flex-direction: column;
		}

		.product-title {
			font-weight: 500;
			margin-bottom: 4px;
		}

		.product-author {
			color: #6b7280;
			font-size: 0.875rem;
		}

		.order-summary {
			background-color: var(--light-bg);
			border-radius: 8px;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
			padding: 20px;
			margin-bottom: 30px;
		}

		.order-summary-title {
			font-size: 1.1rem;
			font-weight: 600;
			margin-top: 0;
			margin-bottom: 15px;
			padding-bottom: 10px;
			border-bottom: 1px solid #e5e7eb;
		}

		.order-summary-grid {
			display: grid;
			grid-template-columns: 1fr auto;
			gap: 10px;
		}

		.order-summary-label {
			font-weight: 500;
			color: #6b7280;
		}

		.order-summary-value {
			font-weight: 500;
			text-align: right;
		}

		.order-summary-total {
			font-weight: 600;
			font-size: 1.1rem;
			color: #111827;
			margin-top: 10px;
			padding-top: 10px;
			border-top: 1px solid #e5e7eb;
		}

		body {
			background-color: #f9fafb;
		}

		.profile-image {
			width: 100px;
			height: 100px;
			object-fit: cover;
		}

		.sidebar {
			width: 240px;
			border-right: 1px solid #dee2e6;
			height: 100%;
			position: fixed;
		}

		.main-content {
			margin-left: 240px;
		}

		.nav-link {
			color: #333;
			padding: 0.75rem 1rem;
			border-radius: 0.375rem;
		}

		.nav-link:hover {
			background-color: #f3f4f6;
		}

		.nav-link.active {
			background-color: #f3f4f6;
			font-weight: 500;
		}

		.nav-link i {
			width: 20px;
			text-align: center;
			margin-right: 10px;
		}

		.order-card {
			border-radius: 0.5rem;
			overflow: hidden;
		}

		.order-header {
			background-color: #f9fafb;
			border-bottom: 1px solid #dee2e6;
		}

		.badge-delivered {
			background-color: #e6f7ee;
			color: #10b981;
		}

		.badge-processing {
			background-color: #fef9c3;
			color: #ca8a04;
		}

		.badge-pending {
			background-color: #e0e7ff;
			color: #4f46e5;
		}

		.badge-cancelled {
			background-color: #fee2e2;
			color: #ef4444;
		}

		.item-image {
			width: 80px;
			height: 80px;
			object-fit: cover;
		}

		@media(max-width: 768px) {
			.sidebar {
				width: 100%;
				height: auto;
				position: relative;
			}

			.main-content {
				margin-left: 0;
			}
		}
	</style>
{% endblock %}

{% block javascripts %}
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}

{% block body %}
	<div class="container-fluid p-0">
		<div class="row g-0">
			<div class="col-auto">
				<div class="sidebar p-3 d-flex flex-column">

					<div class="text-center mb-4">
						<img src="{{ 'https://via.placeholder.com/100' }}" alt="Profile" class="profile-image rounded-circle mb-3">
						<h5 class="mb-1">{{ app.user.firstName ?? '' }}
							{{ app.user.lastName ?? '' }}</h5>
						<p class="text-muted small mb-4">{{ app.user.email }}</p>
					</div>


					<ul class="nav flex-column">
						<li class="nav-item mb-2">
							<a href="" class="nav-link active">
								<i class="bi bi-box"></i>
								Orders
							</a>
						</li>
						<li class="nav-item mb-2">
							<a href="" class="nav-link">
								<i class="bi bi-heart"></i>
								Wishlist
							</a>
						</li>
						<li class="nav-item mb-2">
							<a href="" class="nav-link">
								<i class="bi bi-gear"></i>
								Settings
							</a>
						</li>
						<li class="nav-item">
							<a href="{{ path('app_logout') }}" class="nav-link">
								<i class="bi bi-box-arrow-right"></i>
								Logout
							</a>
						</li>
					</ul>
				</div>
			</div>


			<div class="col">
				<div class="main-content p-4">
					<h2 class="mb-4 pb-3 border-bottom">Order detail</h2>

					<div class="header-container ">
						<h1 class="dashboard-title">Order #{{ order.id }}
							Details</h1>
						<div class="action-buttons">
							<a href="{{path('app_user_profile' , { 'id': app.user.id })}}" class="btn btn-secondary">
								<i class="bi bi-arrow-left"></i>
								Back to List
							</a>
						</div>
					</div>

					<div class="order-details-container">
						<div class="order-card">
							<h2 class="order-card-title">Order Information</h2>
							<div class="order-info-grid">
								<div class="order-info-label">Order ID:</div>
								<div class="order-info-value">#{{ order.id }}</div>

								<div class="order-info-label">Order Date:</div>
								<div class="order-info-value">{{ order.OrderDate ? order.OrderDate|date('F d, Y') : 'N/A' }}</div>

								<div class="order-info-label">Status:</div>
								<div class="order-info-value">
									<span class="status-badge status-{{ order.Status|lower|default('processing') }}">
										{{ order.Status|capitalize|default('Processing') }}
									</span>
								</div>
							</div>
						</div>
					</div>

					<div class="order-items-section">
						<h2 class="order-items-title">Order Items</h2>
						<div class="table-responsive">
							<table class="order-items-table">
								<thead>
									<tr>
										<th>Product</th>
										<th>Price</th>
										<th>Quantity</th>
										<th>Subtotal</th>
									</tr>
								</thead>
								<tbody>
									{% set items = order.getOrderItems() %}
									{% if items is not empty %}
										{% for item in items %}
											<tr>
												<td>
													<div class="product-info">
														<img src="{{ item.imageUrl }}" alt="{{ item.title }}" class="product-image">
														<div class="product-details">
															<div class="product-title">{{ item.title }}</div>
															<div class="product-author">{{ item.author }}</div>
														</div>
													</div>
												</td>
												<td>{{ item.price|number_format(2) }}
													Dt</td>
												<td>{{ item.quantity }}</td>
												<td>{{ item.subtotal|number_format(2) }}
													Dt</td>
											</tr>
										{% endfor %}
									{% else %}
										<tr>
											<td colspan="4" class="text-center py-4">No items found</td>
										</tr>
									{% endif %}
								</tbody>
							</table>
						</div>
					</div>

					<div class="order-summary">
						<h2 class="order-summary-title">Order Summary</h2>
						<div class="order-summary-grid">
							{% set subtotal = 0 %}
							{% set items = order.getOrderItems() %}
							{% if items is not empty %}
								{% for item in items %}
									{% set subtotal = subtotal + item.subtotal %}
								{% endfor %}
							{% endif %}

							<div class="order-summary-label">Subtotal:</div>
							<div class="order-summary-value">{{ subtotal > 0 ? subtotal|number_format(2) : order.Total|default('0.00')|number_format(2) }}
								Dt</div>

							<div class="order-summary-label">Shipping:</div>
							<div class="order-summary-value">7.00 Dt</div>

							<div class="order-summary-label order-summary-total">Total:</div>
							<div class="order-summary-value order-summary-total">{{ order.Total|default(subtotal)|number_format(2) + 7 }}
								Dt</div>
						</div>

					</div>
				</div>
			</div>
		</div>
	{% endblock %}
